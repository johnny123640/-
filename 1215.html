<html>
    <head>
        <title>1215-宇宙射擊遊戲</title>
        <style>
            #spaces {
                width:800px;
                height: 800px;
                background:url("pic/bg_stars.jpg");
                animation: bg_move 2s linear infinite;
            }
            @keyframes bg_stars {
                0%{background-position-x: 0px;}
                100% {background-position-y: 216px;}
            }
        
            #ship {
                width: 40px;
                height: 60px;
                background: url("pic/ship.png");
                background-size: 40px 60px;
                position: absolute;
                
            }
            .ufo {
                width: 60px;
                height: 40px;
                background: url("pic/ufo.png");
                background-size: 60px 40px;
                position: absolute;
            }
            .bullet{
                width: 40px;
                height: 6px;
                background-color: red;
                position: absolute;
            }

        </style>
        <script>

            
            function game_init() {
                dir={"ArrowLeft":0,"ArrowRight":0,"ArrowUp":0,"ArrowDown":0}
                spaces={w:800,h:800}; //定義一個物件
                ship=document.getElementById("ship");
                ship.w=40;
                ship.h=60;
                ship.posX=(spaces.w-ship.w)/2
                ship.posY=spaces.h-ship.h;

                ship.style.left=ship.posX+"px";
                ship.style.top=ship.posY+"px";
                ship.move=setInterval(ship_move,5);
                game_score=0;
                game_time=0;
                game_timer=setInterval(function(){
                    game_time++;
                    document.getElementById("game")

                }
            )
                game_t1=setInterval(ufo_creat,1000);

               
            }
            function game_over() {
                game_starting=false;
                clearInterval(ufo_creater);
                clearInterval(game_timer);
                document.getElementById

                Array.from(document.getElementsByClassName("ufo")).forEach((u)=>{
                    clearInterval(u.move);
                });
                Array.from(document.getElementsByClassName("bullet")).forEach((b)=>{
                    clearInterval(b.move);
                    b.remove();
                });
                document.getElementById("restart").style.display="block";

                var ranking=sessionStorage.getItem("ranking");



                if(ranking==null) {
                 ranking=[];
                 ranking.push({"name":prompt("請輸入你的名稱:"),"score":game_time});
                 sessionStorage.setItem("rank",JSON.stringify(ranking));

                
                }
                else {
                    var data=JSON.parse(ranking);
                    if(data.length<5) {
                        data.push({"name":
                    })
                }
                data=[{"name":"XXX","score":100,"time":64},{"name":"YYY"}]
                sessionStorage.setItem("rank",data);

            }
            function mykeydown() {
                event.preventDefault();
                if(event.key == " ") {
                    shoot();
                } else if(Object.keys(dir).includes(event.key)) {
                    
                
                dir[event.key]=1;
                }
            }

            function mykeyup() {
                event.preventDefault();
                dir[event.key]=0;
                }
                function getRand(min,max) {
                    return Math.floor(Math.random() * (max-min+1)) + min;
                }
                function getRand(min,max) {

                }
            function ship_move() {
                if(ship.posX > 0 && dir["ArrowLeft"]) {
                    ship.posX--;
                } else if(ship.posX + ship.w && dir["ArrowRight"]) {
                    ship.posX++;
                }
                ship.style.left=ship.posX+"px";
                }
            function ufo_move(ufo) {
                if(ufo.posY + ufo.h > spaces.h) {
                    clearInterval(ufo.move);
                    ufo.remove();
                    return;
                } 
                    ufo.posY++;
                    ufo.posX += getRand(-2,2);
                    if(ufo.posX < 0) {
                        ufo.posY=0;
                    } else if(ufo.posX+ufo.w > spaces.w) {
                        ufo.posX = spaces.w - ufo.w;
                    }
                    u.style.left=ufo.posX+"px";
                    u.style.top=ufo.posY+"px";
                
                }
            function ufo_create() {
                    var u=document.createElement("img");
                    u.src="pic/ufo.png";
                    u.className="ufo";
                    u.w=60;
                    u.h=40;
                    u.posX=getRand(0,spaces.w - u.w);
                    u.posY=getRand(0,10);
                    document.getElementById("spaces").appendChild(u);
                    u.style.left=u.posX+"px";
                    u.style.top=u.posY+"px";
                    u.move=setInterval(ufo_move,20,u);
                }
                function bullet_move(bt) {
                    if(bt.posY < 0) {
                        clearInterval(bt.move);
                        bt.remove();
                        return;
                    }}
                    bt.posY--;
                    bt.style.top=bt.posY+"px";

                    var hit_ufo =Array.from(document.getElementByIdClassName("ufo")).filter((u)=>{
                        return(u.posX < bt.posX) && (u.posX + u.w > bt.posX + bt.w) && (u.posY + u.h >= bt.posY);
                        });
                        if(hit_ufo.length > 0) {
                            hit_ufo.forEach((u)=>{
                            clearInterval(u.move);
                            u.remove();
                            });

                            clearInterval(bt.move);
                            bt.remove();
                            game_score++;
                            document.getElementById("score").innerHTML=game_score;
                        


                }
                function shoot() {
                    var b=document.createElement("div");
                    b.className="bullet";
                    b.w=4;
                    b.h=6;
                    b.posX=ship.posX+(ship.w-b.w)/2;
                    b.posY=ship.posY-b.h;
                    document.getElementById("spaces").appendChild(b);
                    b.style.left=b.posX+"px";
                    b.style.top=b.posY+"px";
                    b.move=setInterval(bullet_move,10,b);
                }

                function get_ranking() {
                    if(ranking) {
                        var data=Array.from(JSON.parse(ranking));
                        data.forEach(()=>{
                            var li=document.createElement("li");
                            li.innerHTML=`<span style="width:150px">${x.name}</span`

                        })
                    }
                    
                }
                function do_ranking() {
                    var ranking=sessionStorage.getItem("ranking");
                    if(ranking==null) {
                 ranking=[];
                 ranking.push({"name":prompt("請輸入你的名稱:"),"score":game_time});
                 sessionStorage.setItem("rank",JSON.stringify(ranking));
                    }
                }
                
                
               
                

        </script>
    </head>
    <body onload="game_init()" onkeydown="mykeydown()" onkeyup="mykeyup()">
        <div id="status" style="width:800px;">
            <span>得分:<span id="score">0</span>分</span>
            <span style="float:right;">時間:<span id="game_time">0</span>秒</span>


        </div>
        <div id="spaces">
            <div id="ship"></div>
            <!--img src="pic/ship.png" width="40px"-->
            <div class="bullet"></div>


        </div>
        <div>
            

            
        </div>
        


    </body>
</html>